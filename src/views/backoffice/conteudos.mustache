{{> partials/backoffice/header }}

<main class="admin-main">
    
    <div class="admin-header">
        <h1>Gestão de Conteúdos</h1>
        <button onclick="openAddModal()" class="admin-btn-add"><span>+</span> Adicionar Conteúdo</button>
    </div>

    <div class="search-container admin-filters">
        <form action="/backoffice/conteudos" method="GET" style="display:flex; width:100%; gap:20px;">
            <div class="search-input-wrapper" style="width: 70%;">
                <input type="text" name="q" placeholder="pesquise por título" value="{{query}}">
                <button type="submit"><img src="/public/images/icon-search.svg" alt="Search"></button>
            </div>
            <select name="type" onchange="this.form.submit()" style="width: 30%;">
                <option value="" {{^type}}selected{{/type}}>Todos os Tipos</option>
                <option value="movie" {{#isMovieSelected}}selected{{/isMovieSelected}}>Filmes</option>
                <option value="tv" {{#isTVSelected}}selected{{/isTVSelected}}>TV</option>
            </select>
        </form>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th class="th-id">ID</th>
                    <th class="th-poster">Poster</th>
                    <th>Título</th>
                    <th>Tipo</th>
                    <th>Ano</th>
                    <th class="th-actions">Ações</th>
                </tr>
            </thead>
            <tbody>
                {{#data}}
                <tr>
                    <td>#{{id}}</td>
                    <td>
                        {{#poster_path}}
                            <img src="https://image.tmdb.org/t/p/w92{{poster_path}}" alt="Poster" class="table-thumb">
                        {{/poster_path}}
                        {{^poster_path}}
                            <div style="width:50px; height:75px; background:#333; border-radius:4px;"></div>
                        {{/poster_path}}
                    </td>
                    <td class="primary-text">{{nome}}</td>
                    <td>
                        <span class="badge badge-{{tipo}}">{{tipo}}</span>
                    </td>
                    <td>{{ano_lancamento}}</td>
                    <td class="actions-cell">
                        <button class="btn-action btn-edit" onclick="editItem('conteudos', '{{id}}')" title="Editar">&#9998;</button>
                        <button class="btn-action btn-delete" onclick="deleteContent('{{id}}')" title="Apagar">&#128465;</button>
                    </td>
                </tr>
                {{/data}}
                {{^data}}
                <tr>
                    <td colspan="6" style="text-align:center; padding: 20px;">Nenhum conteúdo encontrado.</td>
                </tr>
                {{/data}}
            </tbody>
        </table>
    </div>
    
    <div id="modalConteudo" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Adicionar Conteúdo</h2>
            <div id="tmdbSearchSection" style="margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 15px;">
                <label style="color: var(--color-primary); font-weight: bold;">1. Pesquisar no TMDB (Auto-preenchimento)</label>
                <div style="position: relative; margin-top: 8px;">
                    <input type="text" id="tmdbSearchInput" placeholder="Digite o nome do filme ou série..." style="width: 100%; padding: 12px; border-radius: 4px; border: 1px solid #555; background: #222; color: white;">
                    <div id="tmdbSearchResults" style="display: none; position: absolute; top: 100%; left: 0; width: 100%; max-height: 250px; overflow-y: auto; background: #1a1a1a; border: 1px solid #444; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.5);"></div>
                </div>
            </div>
            <form id="formConteudo">
                <input type="hidden" id="contentId" name="id">
                <label style="color: var(--color-light-200); font-size: 0.8rem;">2. Confirmar Dados Locais</label>
        
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                <div class="form-group">
                    <label>ID TMDB (Bloqueado):</label>
                    <input type="number" id="tmdb_id" name="tmdb_id" required readonly 
                        style="background: #222; color: #777; cursor: not-allowed; border: 1px solid #444;">
                </div>
                
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="tipoVisual" disabled style="background: #222; color: #aaa; border: 1px solid #444;">
                        <option value="movie">Filme</option>
                        <option value="tv">Série</option>
                    </select>
                    <input type="hidden" id="tipo" name="tipo">
                </div>
            </div>
                <div class="form-group">
                    <label>Título:</label>
                    <input type="text" id="nome" name="nome" required>
                </div>
                <div class="form-group">
                    <label>Sinopse:</label>
                    <textarea id="sinopse" name="sinopse" rows="3" style="padding:12px; background:var(--color-dark-500); border:1px solid var(--color-light-200); border-radius:var(--border-radius); color:white; resize:none;"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Ano:</label>
                        <input type="number" id="ano_lancamento" name="ano_lancamento">
                    </div>
                    <div class="form-group">
                        <label>Duração (min):</label>
                        <input type="number" id="duracao" name="duracao">
                    </div>
                </div>
                <div class="form-group">
                    <label>Caminho do Poster:</label>
                    <input type="text" id="poster_path" name="poster_path">
                </div>
                <div class="form-group">
                    <label>Caminho do Backdrop:</label>
                    <input type="text" id="backdrop_path" name="backdrop_path">
                </div>
                <button type="submit" class="admin-btn-add" style="width: 100%; justify-content: center; margin-top: 10px;">
                    Guardar Conteúdo
                </button>
            </form>
        </div>
    </div>
</main>

<script src="/public/js/admin_content.js"></script>
{{> partials/backoffice/footer }}