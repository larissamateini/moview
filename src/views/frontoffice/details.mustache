{{> partials/frontoffice/header }}

<main>
    <section class="page-title-and-back-btn">
        <button class="back-btn" onclick="history.back()">
            <img src="/public/images/icon-back.svg" alt="Botão Voltar">
        </button>
        <h1>Detalhes</h1>
    </section>

    <section class="movie-details">
        {{#item.poster_path}}
        <img class="movie-poster" src="https://image.tmdb.org/t/p/w500{{item.poster_path}}" alt="Poster de {{item.title}}{{item.name}}">
        {{/item.poster_path}}
        {{^item.poster_path}}
        <div class="movie-poster-placeholder">Sem Imagem</div>
        {{/item.poster_path}}

        <div class="movie-info">
            <div class="movie-details-one">
                <div class="movie-title-and-fav">
                    <h2>{{item.title}}{{item.name}}</h2>
                    <button class="favorite-btn btn-fav {{#isFavorite}}active{{/isFavorite}}" 
                        data-id="{{item.id}}" 
                        data-title="{{item.title}}{{item.name}}" 
                        data-poster="{{item.poster_path}}" 
                        {{!-- Lógica corrigida para Mustache: Se tiver title é movie, caso contrário é tv --}}
                        data-type="{{#item.title}}movie{{/item.title}}{{^item.title}}tv{{/item.title}}"
                        data-overview="{{item.overview}}">
                    <img src="/public/images/icon-fav-{{#isFavorite}}full{{/isFavorite}}{{^isFavorite}}empty{{/isFavorite}}.svg" alt="Botão de Favorito">
                </button>
                </div>
                <div class="details-rating-wrapper">
                    <img src="/public/images/icon-star.svg" alt="Estrela">
                    <span>{{item.vote_average}}</span>
                </div>
            </div>

            <div class="movie-details-two">
                <span class="movie-genre">
                    {{item.genres_string}}
                </span>
                <div class="info-two">
                    <span class="movie-release-year">{{item.release_year}}</span>
                    <span class="movie-duration">
                        {{#item.runtime}}{{item.runtime}}min{{/item.runtime}}
                        {{#item.number_of_seasons}}{{item.number_of_seasons}} Temp.{{/item.number_of_seasons}}
                    </span>
                    <span class="movie-classification">{{item.classification}}</span>
                </div>
            </div>

            <p class="movie-description">
                {{item.overview}}
                {{^item.overview}}Sinopse não disponível para este título.{{/item.overview}}
            </p>

            <div class="movie-details-three">
                <div class="director-wrapper">
                    <span class="label-director">Dirigido por </span>
                    <span class="movie-director">{{item.director}}</span>
                </div>
                <p class="label-cast">Elenco principal</p>
                <p class="movie-cast">{{item.main_cast}}</p>
            </div>
        </div>
    </section>

    <section class="movie-trailer">
        <h3>Trailer</h3>
        {{#trailerKey}}
        <iframe height="400" 
            src="https://www.youtube.com/embed/{{trailerKey}}" 
            title="YouTube video player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            allowfullscreen>
        </iframe>
        {{/trailerKey}}
        {{^trailerKey}}
            <p>Trailer indisponível no momento.</p>
        {{/trailerKey}}
    </section>

    <section class="movie-reviews">
        <h3>Reviews</h3>
        <div class="movies-reviews-wrapper">
            {{#reviews}}
            <div class="review-card">
                <div class="movie-review-wrapper-one">
                    <span class="user-name">{{nome_utilizador}}</span>
                    <div class="thumbs-up-counter-wrapper">
                        <button class="review-btn btn-util" data-id="{{id}}">
                            <img src="/public/images/icon-thumbs-up.svg" alt="Like">
                        </button>
                        <span class="thumbs-up-counter" id="count-{{id}}">{{votos_utilidade}}</span>
                    </div>
                </div>

                <div class="movie-review-wrapper-two">
                    <span class="user-username">@{{username}}</span>
                    <span class="review-date">{{data_formatada}}</span>
                </div>

                <div class="movie-review-wrapper-three">
                    <span class="movie-title">{{item.title}}{{item.name}}</span>
                    <div class="user-rating-wrapper">
                        <span class="star-icon">&#9733;</span>
                        <span>{{classificacao}}/10</span>
                    </div>
                </div>

                <p class="user-review-comment">{{critica}}</p>
            </div>
            {{/reviews}}
            {{^reviews}}
            <p>Ainda não há reviews para este conteúdo. Seja o primeiro a comentar!</p>
            {{/reviews}}
        </div>
    </section>
</main>

{{> partials/frontoffice/footer }}